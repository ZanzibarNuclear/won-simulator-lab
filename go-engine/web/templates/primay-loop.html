{{define "primary-loop"}}
<div class="component-container">
  <h2>Primary Loop</h2>

  <div class="component-layout">
    <div class="component-image">
      <img src="/static/images/primary-loop.png" alt="Primary Loop Diagram">
    </div>

    <div class="component-info">
      <div class="gauge-area">
        <h3>Gauges</h3>
        <div class="gauge">
          <label>Temperature:</label>
          <span id="primary-temp">{{ .PrimaryLoop.Temperature }} °C</span>
        </div>
        <div class="gauge">
          <label>Pressure:</label>
          <span id="primary-pressure">{{ .PrimaryLoop.Pressure }} MPa</span>
        </div>
        <div class="gauge">
          <label>Flow Rate:</label>
          <span id="primary-flow">{{ .PrimaryLoop.FlowRate }} kg/s</span>
        </div>
      </div>

      <div class="control-area">
        <h3>Controls</h3>
        <button id="primary-pump-on" onclick="turnOnPrimaryPump()">Turn On Pump</button>
        <button id="primary-pump-off" onclick="turnOffPrimaryPump()">Turn Off Pump</button>
      </div>
    </div>
  </div>

  <div class="component-description">
    <h3>Description</h3>
    <p>The primary loop is a crucial component of a nuclear reactor. It circulates coolant (usually water) through the
      reactor core, removing heat generated by nuclear fission. This heated water then flows to the steam generator,
      where it transfers its heat to the secondary loop.</p>
    <p>Key features of the primary loop include:</p>
    <ul>
      <li>Reactor vessel: Contains the nuclear fuel and where fission occurs</li>
      <li>Primary coolant pump: Circulates the coolant through the system</li>
      <li>Steam generator: Transfers heat from the primary to the secondary loop</li>
      <li>Pressurizer: Maintains system pressure and compensates for coolant volume changes</li>
    </ul>
  </div>
</div>
{{end}}

<script>
  function turnOnPrimaryPump() {
    // AJAX call to turn on primary pump
    fetch('/api/sims/{{ .SimID }}/primary-pump/on', { method: 'PUT' })
      .then(response => response.json())
      .then(data => updatePrimaryLoopStatus(data))
      .catch(error => console.error('Error:', error));
  }

  function turnOffPrimaryPump() {
    // AJAX call to turn off primary pump
    fetch('/api/sims/{{ .SimID }}/primary-pump/off', { method: 'PUT' })
      .then(response => response.json())
      .then(data => updatePrimaryLoopStatus(data))
      .catch(error => console.error('Error:', error));
  }

  function updatePrimaryLoopStatus(data) {
    // Update the gauge values with new data
    document.getElementById('primary-temp').textContent = data.PrimaryLoop.Temperature + ' °C';
    document.getElementById('primary-pressure').textContent = data.PrimaryLoop.Pressure + ' MPa';
    document.getElementById('primary-flow').textContent = data.PrimaryLoop.FlowRate + ' kg/s';
  }
</script>