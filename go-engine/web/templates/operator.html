{{define "operator"}}
<div class="operator-container">
    <div class="sim-card">
        <h2><span id="active-sim-name"></span></h2>
        <div class="sim-details">
            <p><strong>ID:</strong> <span id="active-sim-id"></span></p>
            <p><strong>Motto:</strong> <span id="active-sim-motto"></span></p>
            <p><strong>Spawned At:</strong> <span id="active-sim-spawned-at"></span></p>
        </div>
    </div>

    <div class="sim-controls">
        <h3>Simulator Controls</h3>
        <div class="advance-control">
            <select id="advance-steps">
                <option value="1" selected>1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
            <select id="advance-unit">
                <option value="minutes" selected>Minutes</option>
                <option value="hours">Hours</option>
                <option value="days">Days</option>
            </select>
            <button id="advance-sim">Advance Simulation</button>
        </div>
    </div>

    <div class="sim-status">
        <h3>Operational Status</h3>
        <div class="top-level-status sim-card">
            <div id="overall-status" class="sim-details">
                <p><strong>Simulation Time:</strong> <span id="current-time">N/A</span></p>
                <p><strong>Operational State:</strong> <span id="operational-state">N/A</span></p>
                <p><strong>Power Output:</strong> <span id="power-output">N/A</span> MW</p>
                <p><strong>Core Temperature:</strong> <span id="core-temperature">N/A</span> Â°C</p>
                <p><strong>Coolant Pressure:</strong> <span id="coolant-pressure">N/A</span> MPa</p>
            </div>
        </div>

        <div id="status-display">
            <div class="component-status">
                <h4>Component Status</h4>
                <div id="component-details" class="sim-card">
                    <div class="sim-details">
                        <p><strong>Reactor:</strong> <span id="reactor-status">N/A</span></p>
                        <p><strong>Turbine:</strong> <span id="turbine-status">N/A</span></p>
                        <p><strong>Generator:</strong> <span id="generator-status">N/A</span></p>
                        <p><strong>Condenser:</strong> <span id="condenser-status">N/A</span></p>
                        <p><strong>Cooling Tower:</strong> <span id="cooling-tower-status">N/A</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let activeSimId = null;

    function updateSimInfo(simInfo) {
        document.getElementById('active-sim-id').textContent = simInfo.id;
        document.getElementById('active-sim-name').textContent = simInfo.name;
        document.getElementById('active-sim-motto').textContent = simInfo.motto;
        document.getElementById('active-sim-spawned-at').textContent = new Date(simInfo.spawned_at).toLocaleString();
        activeSimId = simInfo.id;
    }

    function updateStatus(status) {
        const formattedTime = formatDateTime(new Date(status.simTime));
        document.getElementById('current-time').textContent = formattedTime;
        document.getElementById('operational-state').textContent = status.running ? 'Running' : 'Stopped';
        document.getElementById('power-output').textContent = status.powerOutput || 'N/A';
        document.getElementById('core-temperature').textContent = status.coreTemperature || 'N/A';
        document.getElementById('coolant-pressure').textContent = status.coolantPressure || 'N/A';
    }

    document.getElementById('advance-sim').addEventListener('click', () => {
        if (!activeSimId) return;
        const steps = document.getElementById('advance-steps').value;
        const unit = document.getElementById('advance-unit').value;
        let totalSteps = parseInt(steps);

        if (unit === 'hours') {
            totalSteps *= 60;
        } else if (unit === 'days') {
            totalSteps *= 1440; // 24 hours * 60 minutes
        }

        fetch(`/api/sims/${activeSimId}/advance`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ steps: totalSteps })
        })
            .then(response => response.json())
            .then(status => updateStatus(status))
            .catch(error => console.error('Error:', error));
    });

    // Fetch initial simulation info and status
    const urlParams = new URLSearchParams(window.location.search);
    const simId = urlParams.get('id');
    if (simId) {
        fetch(`/api/sims/${simId}`)
            .then(response => response.json())
            .then(simInfo => {
                updateSimInfo(simInfo);
                return fetch(`/api/sims/${simId}/status`);
            })
            .then(response => response.json())
            .then(status => updateStatus(status))
            .catch(error => console.error('Error:', error));
    } else {
        console.error('No simulation ID provided in URL');
    }
</script>
{{end}}